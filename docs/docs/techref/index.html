
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../software/">
      
      
        <link rel="next" href="../hmi/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.10">
    
    
      
        <title>Technical Reference - MODAQ 2 (M2)</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#m2-technical-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="MODAQ 2 (M2)" class="md-header__button md-logo" aria-label="MODAQ 2 (M2)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MODAQ 2 (M2)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Technical Reference
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="MODAQ 2 (M2)" class="md-nav__button md-logo" aria-label="MODAQ 2 (M2)" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    MODAQ 2 (M2)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../github/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Github
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../hardware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hardware
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../software/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Technical Reference
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Technical Reference
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ros2-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      ROS2 Nodes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-time" class="md-nav__link">
    <span class="md-ellipsis">
      Real-Time
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-Time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#latency" class="md-nav__link">
    <span class="md-ellipsis">
      Latency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#real-time-linux" class="md-nav__link">
    <span class="md-ellipsis">
      Real-Time Linux
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validating-rt-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Validating RT Performance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#precision-time-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      Precision Time Protocol
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adcs" class="md-nav__link">
    <span class="md-ellipsis">
      ADCs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-20-ma-current-loops" class="md-nav__link">
    <span class="md-ellipsis">
      4-20 mA Current Loops
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heading" class="md-nav__link">
    <span class="md-ellipsis">
      Heading
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../hmi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HMI
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../configurator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configurator
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../links/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Useful Links
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ros2-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      ROS2 Nodes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-time" class="md-nav__link">
    <span class="md-ellipsis">
      Real-Time
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-Time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#latency" class="md-nav__link">
    <span class="md-ellipsis">
      Latency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#real-time-linux" class="md-nav__link">
    <span class="md-ellipsis">
      Real-Time Linux
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validating-rt-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Validating RT Performance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#precision-time-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      Precision Time Protocol
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adcs" class="md-nav__link">
    <span class="md-ellipsis">
      ADCs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-20-ma-current-loops" class="md-nav__link">
    <span class="md-ellipsis">
      4-20 mA Current Loops
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heading" class="md-nav__link">
    <span class="md-ellipsis">
      Heading
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<style>
    img[src*='#left'] {
     float: left;
    }
    img[src*='#right'] {
        float: right;
    }
    img[src*='#center'] {
        display: block;
        margin: auto;
    }
</style>

<h1 id="m2-technical-reference">M2 Technical Reference <img alt="MODAQ M2 Tech Ref" src="../img/m2_logo.png#right" /><a class="headerlink" href="#m2-technical-reference" title="Permanent link">&para;</a></h1>
</p>
<h2 id="ros2-nodes">ROS2 Nodes<a class="headerlink" href="#ros2-nodes" title="Permanent link">&para;</a></h2>
<p>The M2 Reference Design includes the following nodes. Click on the item to expand its description.</p>
<details>
    <summary>Node: m2_supervisor_node</summary>
    <br>This node manages a number of MODAQ's core functionality, which include system logger, email alerts, and rate limiter (snoozer) <br><br> 
    <b>Package: </b>m2_supervisor<br>
    <b>Alias: </b>M2Supervisor<br>
    <b>Configuration Parameters: </b>log file path, log file size limit, SMTP settings, distribution email lists (2x), analyzed topics, email snooze interval<br>
    <b>Publishers: </b>/system_messenger<br>
    <b>Subscriptions: </b>/system_messenger<br>
</details>
<details>
    <summary>Node: bag_recorder_node</summary>
    <br>Node description<br><br>
    <b>Package: </b>bag_recorder<br>
    <b>Alias: </b>N/A<br>
    <b>Configuration Parameters: </b>IP address<br>
    <b>Publishers: </b>/system_messenger<br>
    <b>Subscriptions: </b>/system_messenger, /ain, /do, /din, /rtd, /bag_control<br>
</details>
<details>
    <summary>Node: labjack_ain_reader</summary>
    <br>Reads up to 8 AI channels simultaneously from a single Labjack T8. This node uses a configurable timer to fetch (poll) channel reads from the T8.<br><br>
    <b>Package: </b>labjack_t8_ros2<br>
    <b>Alias: </b>LabjackAINSlow<br>
    <b>Configuration Parameters: </b>IP address, sample rate, topic name<br>
    <b>Publishers: </b>/system_messenger, /ain_slow<br>
    <b>Subscriptions: </b>none<br>
</details>
<details>
    <summary>Node: labjack_ain_streamer</summary>
    <br>Streams up to 8 AI channels from a single Labjack T8. This node sets the T8 to stream data continuously at rates up to 40 kHz. Channel reads are simultaneous. To better manage network resources for high speed streams, data transfers are batched by the ScansPerRead parameter.<br><br>
    <b>Package: </b>labjack_t8_ros22<br>
    <b>Alias: </b>LabjackAINFast<br>
    <b>Configuration Parameters: </b>IP address, sample rate, scans per read, topic name<br>
    <b>Publishers: </b>/system_messenger, /ain_fast<br>
    <b>Subscriptions: </b>none<br>
</details>
<details>
    <summary>Node: labjack_dac_writer</summary>
    <br>Controls one or more analog outputs on the T8. Output voltage can be adjusted between 0-10 VDC or ±10v with the LJTick-DAC<br><br>
    <b>Package: </b>labjack_t8_ros2<br>
    <b>Alias: </b>LabjackDAC<br>
    <b>Configuration Parameters: </b>IP address, channel selection, topic name<br>
    <b>Publishers: </b>/system_messenger<br>
    <b>Subscriptions: </b>/LJ_Ctl_Pub<br>
</details>
<details>
    <summary>Node: labjack_do_node</summary>
    <br>Switches one or more digital output (logic level) channels on the T8 high or low.<br><br>
    <b>Package: </b>labjack_t8_ros2<br>
    <b>Alias: </b>LabjackDO<br>
    <b>Configuration Parameters: </b>IP address, topic name<br>
    <b>Publishers: </b>/system_messenger<br>
    <b>Subscriptions: </b>/do<br>
</details>
<details>
    <summary>Node: labjack_dio_reader</summary>
    <br>Reads the logic state of one or more DIO channels.<br><br>
    <b>Package: </b>labjack_t8_ros2<br>
    <b>Alias: </b>LabjackDIN<br>
    <b>Configuration Parameters: </b>IP address, topic name<br>
    <b>Publishers: </b>/system_messenger, /din<br>
    <b>Subscriptions: </b>none<br>
</details>
<details>
    <summary>Node: adnav_driver</summary>
    <br>Manages configuration and initialization of the Advanced Navigation GNSS Compass and publishes its data.<br><br>
    <b>Package: </b>adnav_gnss_compass<br>
    <b>Alias: </b>AdnavCompass<br>
    <b>Configuration Parameters: </b>too many to list here<br>
    <b>Publishers: </b>/system_messenger, /nav<br>
    <b>Subscriptions: </b>none<br>
</details>
<details>
    <summary>Node: xsens_mti_node</summary>
    <br>Manages configuration and initialization of the Xsens MTi-G-710 and publishes its data. This is a 3rd party package cloned from <a href="https://github.com/cnicho35/bluespace_ai_xsens_ros_mti_driver" target="_blank">here</a>.  This can work with other Xsens inertial sensors too.<br><br>
    <b>Package: </b>bluespace_ai_xsens_ros_mti_driver<br>
    <b>Alias: </b>XsensINS<br>
    <b>Configuration Parameters: </b>too many to list here<br>
    <b>Publishers: </b>/system_messenger, /imu/acceleration<br>
    <b>Subscriptions: </b>none<br>
</details>
<details>
    <summary>Node: ed582_driver</summary>
    <br>Reads up to four channels of RTD temperature measurements from a Brainbox ED-582. This is adapted from a 3rd party API available <a href="https://www.brainboxes.com/faq/how-do-i-use-cpp-to-communicate-with-my-remote-io-module" target="_blank">here</a>.<br><br>
    <b>Package: </b>ed582<br>
    <b>Alias: </b>RTDed582<br>
    <b>Configuration Parameters: </b>IP address, sample rate, topic name<br>
    <b>Publishers: </b>/system_messenger, /rtd<br>
    <b>Subscriptions: </b>none<br>
</details>
<details>
    <summary>Node: m2_control</summary>
    <br>This node can read directives published by the HMI and/or incorporate control logic and publish actions for digital or analog output channels.<br><br>
    <b>Package: </b>m2_control<br>
    <b>Alias: </b>M2Control<br>
    <b>Configuration Parameters: </b>IP address, sample rate, topic name<br>
    <b>Publishers: </b>/system_messenger, /dac, /do<br>
    <b>Subscriptions: </b>/hmi_ctl<br>
</details>
<details>
    <summary>Node: rosbridge_websocket</summary>
    <br>This node creates a bridge between ROS2 and a websocket that is used to subscribe to and publish topics from a webpage using roslibjs. This is a lightly modified version of rosbridge_server from the <a href="https://github.com/RobotWebTools/rosbridge_suite" target="_blank">rosbridge_suite</a> github repo.<br><br>
    <b>Package: </b>rosbridge_server_m2<br>
    <b>Alias: </b>Rosbridge<br>
    <b>Configuration Parameters: </b>none<br>
    <b>Publishers: </b>/hmi_ctl<br>
    <b>Subscriptions: </b>/din, /ain_slow, /rtd<br>
</details>

<h2 id="real-time">Real-Time<a class="headerlink" href="#real-time" title="Permanent link">&para;</a></h2>
<p>A real-time system is one that assures certain deadlines are met reliably within expected time constraints. See this <a href="https://en.wikipedia.org/wiki/Real-time_computing" target="_blank">Wikipedia article</a> for a more complete definition.  </p>
<div class="admonition tip">
<p class="admonition-title">Recommended Reading</p>
<p><a href="https://shuhaowu.com/blog/2022/01-linux-rt-appdev-part1.html" target="_blank">This</a> series of blog posts by Shuhao Wu is an excellent, easy to read distillation of numerous resources on real-time computing. This is highly recommended reading to provide context to some of the topics that will be discussed in this section.</p>
</div>
<p>Using a real-time architecture and approach in MODAQ allows better management of sources of latency and reduction of jitter. What this means in practical terms is that certain time-critical loops, processes, or functions can execute deterministically and that variation in timing of successive iterations is kept low.  </p>
<h3 id="latency">Latency<a class="headerlink" href="#latency" title="Permanent link">&para;</a></h3>
<p>Opening Task Manager in Windows or the equivalent in in other operating systems (OS), there may be hundreds of processes listed that are all vying for a slice of the CPU's time. These include things like device drivers, software updaters, user software, malware detectors, and lots of other things that comprise the modern computing experience. With fast, multi-core processors, these appear to be seamlessly juggled, usually with little delay apparent to the user. This is all managed by the scheduler and it tries to be fair as it doles out access to a CPU core. Under critical analysis, an application may have to wait a non-deterministic amount of time for that CPU attention- and that wait time might vary considerably for each request. This variation may be only a few milliseconds (or longer) but for DAQs running loops hundreds or several thousand times per second, that's an eternity. </p>
<p>A properly configured real-time stack offers the software developer some tools to better manage how the real-time code gets its CPU time by preempting lower priority processes (jumping to the head of the line). The end effect is that the real-time code should experience less of this source of latency.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><b>Determinism</b>
<p>
A deterministic real-time system should complete a task within a bound time period in a consistent and repeatable manner. </p>
</div>
<p>Different real-time approaches yield better or worse maximum latency periods. Specific project requirements or use-cases often dictate the maximum acceptable latency for a particular application. This is most common for safety-critical systems, such as an anti-lock brake controller, where missing a deadline can result in disaster. These will often be associated with terms such as "guaranteed" or "hard" real-time. From a system architecture and software development standpoint, achieving this level of latency and determinism is difficult and probably not practical nor even necessary for a DAQ such as M2. </p>
<p>However, in the space between extremely low latency, safety-critical, real-time systems and general purpose operating systems without real-time support, there is <a href="https://wiki.linuxfoundation.org/realtime/start" target="_blank">Real-Time Linux</a>. Or, more correctly, the PREEMPT_RT patch for Linux kernels.   </p>
<h3 id="real-time-linux">Real-Time Linux<a class="headerlink" href="#real-time-linux" title="Permanent link">&para;</a></h3>
<p>Linux with the PREEMPT_RT patch has been successfully used in various industries such as automotive, space, and industrial automation for years and by organizations including National Instruments, NASA, and SpaceX.<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup><sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup> This lends confidence that it's appropriate for M2 applications.</p>
<p>At the time of writing, it appears that the mainline Linux kernel is expected to gain real-time support<sup id="fnref:3"><a class="footnote-ref" href="#fn:3">3</a></sup> in a coming release. Until that happens, it's necessary to <a href="https://docs.ros.org/en/humble/Tutorials/Miscellaneous/Building-Realtime-rt_preempt-kernel-for-ROS-2.html" target="_blank">manually compile the kernel with the PREEMPT_RT patch</a> or find a distribution for an already patched RT kernel.   </p>
<h3 id="validating-rt-performance">Validating RT Performance<a class="headerlink" href="#validating-rt-performance" title="Permanent link">&para;</a></h3>
<p>Once patched kernel has been installed and the necessary changes to BIOS have been made, it's necessary to conduct some tests on the system to validate the 'as-built' latency performance. </p>
<p>A very useful tool for this is provided by intel: <a href="https://eci.intel.com/docs/3.3/development/performance/benchmarks.html#about-rtpm" target="_blank">RTPM</a>. This tool will evaluate the settings on your computer to ensure they are optimized for real-time performance. It also will conduct several tests that will characterize your real-time performance.</p>
<h2 id="precision-time-protocol">Precision Time Protocol<a class="headerlink" href="#precision-time-protocol" title="Permanent link">&para;</a></h2>
<p>The promise of PTP is that all connected PTP-aware devices will be synchronized and reference-time accurate to 100's, if not 10's of nanoseconds- without drift. By comparison, <a href="https://en.wikipedia.org/wiki/Network_Time_Protocol" target="_blank">Network Time Protocol</a> (NTP), which is what most consumer computers and laptops use as a time reference, can at best achieve 10's of milliseconds accuracy. While NTP accuracy might be perfectly acceptable to some and often better than a real time clock (which can drift <a href="https://www.best-microcontroller-projects.com/ppm.html" target="-blank">several seconds a day</a>), it's a ~6 order of magnitude difference in accuracy as compared to PTP. If a quality time reference is not available, samples taken from input modules on the same DAQ controller will be disciplined by the same clock and will likely be <i>precisely</i> timestamped relative each other, but may not be <i>accurate</i> to actual time (i.e. UTC) . </p>
<p>Where the real power of PTP is realized is in synchronizing samples taken by disparate systems. These can be DAQs on the same subnet, sharing the same master clock or systems completely disconnected from each other and separated miles apart. As long as each system is disciplined to a healthy PTP reference clock, the samples will be synchronized to the aforementioned nanosecond time precision. This is a boon for distributed architectures and system design flexibility, allowing multi-controller synchronization without physical interconnections. </p>
<p>In our experience, PTP implementation either works magically or is a real bear. It does help to have some knowledge of networking and configuring managed switches. PTP requires the following for optimal performance:</p>
<ol>
<li>PTP time server</li>
<li>PTP-capable endpoints (e.g. M2 controller, ethernet based devices)</li>
<li>PTP services configured and running on the endpoints</li>
<li>PTP-capable network switch</li>
</ol>
<p>These items need to be properly configured, otherwise the PTP performance may be degraded or non-existent. </p>
<h2 id="adcs">ADCs<a class="headerlink" href="#adcs" title="Permanent link">&para;</a></h2>
<p>Coming soon...</p>
<h2 id="4-20-ma-current-loops">4-20 mA Current Loops<a class="headerlink" href="#4-20-ma-current-loops" title="Permanent link">&para;</a></h2>
<p>Coming soon...</p>
<h2 id="heading">Heading<a class="headerlink" href="#heading" title="Permanent link">&para;</a></h2>
<p>Getting a reliable estimate of heading on a fixed or semi-stationary device can be tricky. Devices that rely on Earth's magnetic field need to be calibrated in-situ and have the proper magnetic declination correction applied. </p>
<p>Since a calibration procedure generally requires rotating the sensor 360° in one or more axis, this is often difficult or near impossible once the sensor is mounted on the device (WEC, buoy, etc). It's easier to calibrate the compass prior to installation, however this is not effective, since the magnetic field will most likely be distorted by the presence of hard and soft iron sources near the mounting location. </p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>https://www.linux.com/news/in-the-trenches-with-thomas-gleixner-real-time-linux-kernel-patch-set/&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>https://ntrs.nasa.gov/api/citations/20200002390/downloads/20200002390.pdf&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p>https://arstechnica.com/gadgets/2024/09/real-time-linux-is-officially-part-of-the-kernel-after-decades-of-debate/&#160;<a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
</ol>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>